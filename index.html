<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promptify</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Include Marked.js library -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* Custom scrollbar - Light Theme */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #e2e8f0; /* slate-200 */
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8; /* slate-400 */
            border-radius: 5px;
            border: 2px solid #e2e8f0; /* slate-200, to give padding effect */
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b; /* slate-500 */
        }

        /* Simplified Title Style */
        .title-glow {
            color: #0ea5e9; /* sky-500 */
        }
        
        textarea::placeholder {
            color: #94a3b8; /* slate-400 */
            font-style: italic;
            opacity: 0.9;
        }

        #outputContainer.hidden-output {
            opacity: 0;
            transform: translateY(30px) scale(0.95);
            max-height: 0;
            overflow: hidden;
            margin-top: 0 !important; margin-bottom: 0 !important;
            padding-top: 0 !important; padding-bottom: 0 !important;
        }
        #outputContainer {
            transition: opacity 0.4s ease-out, transform 0.4s ease-out, max-height 0.5s ease-in-out, padding 0.3s ease-in-out, margin 0.3s ease-in-out;
            opacity: 1;
            transform: translateY(0) scale(1);
            max-height: 1200px; 
            overflow-y: auto;  
        }
        
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.25); /* Lighter track for better contrast */
            border-radius: 50%;
            border-top-color: #ffffff; /* White for visibility */
            width: 20px; height: 20px;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        body { background-color: #f1f5f9; /* slate-100 */ }
        .app-card {
            background-color: #ffffff; /* white */
            border: 1px solid #e2e8f0; /* slate-200 */
        }
        .input-label-icon { transition: transform 0.3s ease-in-out; }
        label:hover .input-label-icon { transform: rotate(-10deg) scale(1.1); }
        
        textarea:focus {
            outline: none; /* Explicitly remove default browser outline */
            border-color: #0ea5e9; /* sky-500 - for the actual border line */
            box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.35); /* sky-500 with 35% opacity, now 4px thick */
        }

        #refineButton:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(14, 165, 233, 0.25), 0 3px 6px rgba(0,0,0,0.1);
        }
         #refineButton:active {
            transform: translateY(0px);
            box-shadow: 0 4px 8px rgba(14, 165, 233, 0.2), 0 2px 3px rgba(0,0,0,0.1);
        }
        
        /* Styling for the div that will contain Markdown HTML */
        #refinedPromptOutput {
            background-color: #f8fafc; /* slate-50 */
            border: 1px solid #e2e8f0; /* slate-200 */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            color: #334155; /* slate-700, for text color */
            line-height: 1.6; /* for readability */
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"; /* Default sans-serif font */
        }
        /* Styling for elements generated by Marked.js */
        #refinedPromptOutput > *:first-child { margin-top: 0; } /* Remove top margin from first element if any */
        #refinedPromptOutput > *:last-child { margin-bottom: 0; } /* Remove bottom margin from last element if any */

        #refinedPromptOutput ul, #refinedPromptOutput ol {
            margin-left: 1.5rem; /* Indentation for lists */
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }
        #refinedPromptOutput ul {
            list-style-type: disc;
        }
        #refinedPromptOutput ol {
            list-style-type: decimal;
        }
        #refinedPromptOutput li {
            margin-bottom: 0.25rem; /* Spacing between list items */
        }
        #refinedPromptOutput p {
            margin-bottom: 0.75rem;
        }
        #refinedPromptOutput strong, #refinedPromptOutput b {
            font-weight: 600; /* Tailwind's font-semibold */
        }
        #refinedPromptOutput em, #refinedPromptOutput i {
            font-style: italic;
        }
        #refinedPromptOutput code:not(pre code) { /* Inline code */
            background-color: #e2e8f0; /* slate-200 */
            color: #c026d3; /* fuchsia-600 for some pop */
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-size: 0.875em;
        }
        #refinedPromptOutput pre { /* Code blocks */
            background-color: #f1f5f9; /* slate-100 */
            border: 1px solid #e2e8f0; /* slate-200 */
            padding: 0.75rem;
            border-radius: 0.375rem;
            overflow-x: auto;
            margin-bottom: 1rem;
            font-size: 0.875em;
        }
        #refinedPromptOutput pre code {
            background-color: transparent;
            color: inherit;
            padding: 0;
            border-radius: 0;
            font-size: 1em;
        }


        #copyButton {
            background-color: #e2e8f0; /* slate-200 */
            color: #475569; /* slate-600 default color for icon */
            transition: all 0.2s ease-in-out;
        }
        #copyButton:hover:not(.text-green-500) { /* Prevent hover style change when checkmark is green */
            background-color: #cbd5e1; /* slate-300 */
            color: #1e293b; /* slate-800 */
            transform: scale(1.05);
        }
        #copyButton:active:not(.text-green-500) {
             transform: scale(0.95);
        }

        /* Animation for the checkmark appearing */
        @keyframes pulse-once {
            0% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.25); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pulse-once {
            animation: pulse-once 0.4s ease-in-out;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 selection:bg-sky-500 selection:text-white antialiased">

    <div class="w-full max-w-3xl mx-auto">
        <div class="app-card rounded-xl p-6 sm:p-8 md:p-10 space-y-8">
            
            <header class="text-center space-y-2">
                <div class="flex items-center justify-center space-x-3">
                    <!-- Updated Header Logo -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-10 h-10 text-sky-500" fill="none">
                        <path d="M13 2H6C4.89543 2 4 2.89543 4 4V20C4 21.1046 4.89543 22 6 22H18C19.1046 22 20 21.1046 20 20V9L13 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="currentColor" fill-opacity="0.1"/>
                        <path d="M13 2V9H20" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <!-- Main Sparkle (wand effect) -->
                        <path d="M12.5 12.5l-1.5 2.5l-2.5 1.5l2.5 1.5l1.5 2.5l1.5-2.5l2.5-1.5l-2.5-1.5l-1.5-2.5z" fill="#0ea5e9"/>
                        <!-- Smaller accent sparkle -->
                        <path d="M17 10l-0.5 1l-1 0.5l1 0.5l0.5 1l0.5-1l1-0.5l-1-0.5l-0.5-1z" fill="#0ea5e9" opacity="0.7"/>
                    </svg>
                    <h1 class="text-4xl sm:text-5xl font-bold title-glow text-sky-600">
                        Promptify
                    </h1>
                </div>
            </header>

            <main class="space-y-6 md:space-y-8 flow-root">
                <section class="input-area p-5 bg-slate-50 rounded-lg shadow-sm border border-slate-200">
                    <label for="userInput" class="block text-base font-semibold text-sky-700 mb-3 flex items-center group">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 mr-2 text-sky-500 input-label-icon group-hover:text-sky-600">
                            <path d="M21.731 2.269a2.625 2.625 0 00-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 000-3.712zM19.513 8.199l-3.712-3.712-12.15 12.15a5.25 5.25 0 00-1.32 2.214l-.8 2.685a.75.75 0 00.933.933l2.685-.8a5.25 5.25 0 002.214-1.32L19.513 8.2z" />
                        </svg>
                        Craft Your Initial Prompt:
                    </label>
                    <div class="flex justify-between mb-2">
    <button id="pasteButton" class="p-2 rounded-md bg-slate-100 hover:bg-slate-200 text-slate-600 transition-colors duration-200 flex items-center space-x-1" title="Paste from clipboard">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.029-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.2185a48.208 48.208 0 011.927-.184" />
        </svg>
        <span class="text-xs">Paste</span>
    </button>
    <button id="clearButton" class="p-2 rounded-md bg-slate-100 hover:bg-slate-200 text-slate-600 transition-colors duration-200 flex items-center space-x-1" title="Clear input">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
        <span class="text-xs">Clear</span>
    </button>
</div>
<textarea id="userInput" rows="7" class="w-full p-4 bg-white border border-2 border-sky-200 rounded-lg shadow-inner focus:ring-0 text-slate-700 placeholder-slate-400 resize-none text-base transition-colors duration-200" placeholder="Enter or paste your idea"></textarea>
                </section>

                <div class="flex justify-center">
                    <button id="refineButton" class="bg-gradient-to-r from-sky-500 via-cyan-500 to-teal-400 hover:from-sky-600 hover:via-cyan-600 hover:to-teal-500 text-white font-semibold py-3.5 px-8 rounded-lg shadow-md hover:shadow-xl transform transition-all duration-200 ease-in-out focus:outline-none focus:ring-4 focus:ring-sky-500/40 active:scale-95 flex items-center justify-center space-x-2.5 text-lg">
                        <!-- Updated Refine Button Icon (Wand) -->
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6.25 20.75L19.5 7.5L16.5 4.5L3.25 17.75L6.25 20.75Z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M14.75 5.75L18.25 9.25" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 3.5L7.5 2M10.5 5L9 3.5" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19 14.5L17.5 13M20.5 16L19 14.5" />
                        </svg>
                        <span id="buttonText">Refine Prompt</span>
                        <div id="spinner" class="spinner hidden"></div>
                    </button>
                </div>

                <section id="outputContainer" class="output-area p-5 bg-slate-50 rounded-lg shadow-sm border border-slate-200 space-y-3 hidden-output mt-8 relative">
                    <button id="copyButton" title="Copy to Clipboard" class="absolute top-5 right-5 p-2 rounded-md opacity-60 hover:opacity-100 focus:opacity-100 transition-all duration-200 z-10">

                    </button>
                    <label class="block text-base font-semibold text-green-600 mb-2 flex items-center group">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-2 text-green-500 input-label-icon group-hover:text-green-600">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Polished & Optimized Prompt:
                    </label>
                    <!-- Changed from pre to div for HTML rendering -->
                    <div id="refinedPromptOutput" class="w-full p-4 rounded-lg min-h-[120px] text-sm sm:text-base"></div>
                    <p id="copyFeedback" class="text-sm text-green-600 h-5 text-right pr-1"></p>
                </section>

                <div id="errorDisplay" class="text-red-700 bg-red-100 border border-red-300 p-4 rounded-lg shadow-md hidden items-start space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-red-500 flex-shrink-0">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                    </svg>
                    <span class="error-message-text"></span>
                </div>
            </main>

            <footer class="text-center pt-6">
            </footer>
        </div>
    </div>

    <script>
        const API_KEY = "AIzaSyDSF270Y1VJf1fe4G8ZAuw7bOITbAlal74";
        const MODEL_NAME = "gemini-2.5-flash-preview-05-20";
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`;

        // The SYSTEM_INSTRUCTION_TEXT still asks the model to preserve raw list formatting, which Marked.js will then parse.
        const SYSTEM_INSTRUCTION_TEXT = `“As an AI prompt engineer, your core responsibility is to refine user input into a clear, structured development prompt. Do not include general explanations or descriptions. Begin your output with a clear action phrase like ‘Create a’ or ‘Develop a’ to indicate prompt development.

Key focus areas include:
1. Core Functionality derivation based on user input.
2. UI Elements specification based on user input.
3. Feature identification based on user input.
4. User Interface Design suggestion based on user input."

.`


        const userInputEl = document.getElementById('userInput');
        const refineButtonEl = document.getElementById('refineButton');
        const pasteButtonEl = document.getElementById('pasteButton');
        const clearButtonEl = document.getElementById('clearButton');
        const buttonTextEl = document.getElementById('buttonText');
        const spinnerEl = document.getElementById('spinner');
        const outputContainerEl = document.getElementById('outputContainer');
        const refinedPromptOutputEl = document.getElementById('refinedPromptOutput'); // This is now a DIV
        const copyButtonEl = document.getElementById('copyButton');
        const copyFeedbackEl = document.getElementById('copyFeedback');
        const errorDisplayEl = document.getElementById('errorDisplay');
        const errorMessageTextEl = errorDisplayEl.querySelector('.error-message-text');

        const copyIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125V15m12-4.5h.01M15 12h.01M12 15h.01M15 15h.01M9 12h.01M9 15h.01M12 12h.01" />
                            </svg>`;
        const checkmarkIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-5 h-5">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                                  </svg>`;
        
        if (copyButtonEl) {
            copyButtonEl.innerHTML = copyIconSVG;
        }

        // Configure Marked.js for line breaks
        marked.setOptions({
            breaks: true, // Interpret carriage returns and newlines as <br>
            gfm: true // Enable GitHub Flavored Markdown (includes strikethrough, tables, etc.)
        });


        refineButtonEl.addEventListener('click', handleRefinePrompt);
        copyButtonEl.addEventListener('click', copyToClipboard);
        pasteButtonEl.addEventListener('click', handlePaste);
        clearButtonEl.addEventListener('click', handleClear);
        
        userInputEl.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleRefinePrompt();
            }
        });
        
        async function handlePaste() {
            try {
                const text = await navigator.clipboard.readText();
                userInputEl.value = text;
            } catch (err) {
                console.error('Failed to paste:', err);
                displayError("Failed to paste from clipboard");
            }
        }
        
        function handleClear() {
            userInputEl.value = '';
            refinedPromptOutputEl.innerHTML = '';
            outputContainerEl.classList.add('hidden-output');
        }
        
        function copyToClipboard() {
            const outputText = refinedPromptOutputEl.innerText;
            navigator.clipboard.writeText(outputText)
                .then(() => {
                    copyButtonEl.innerHTML = checkmarkIconSVG;
                    copyButtonEl.classList.add('text-green-500');
                    copyFeedbackEl.textContent = 'Copied!';
                    copyFeedbackEl.classList.add('animate-pulse-once');
                    
                    setTimeout(() => {
                        copyButtonEl.innerHTML = copyIconSVG;
                        copyButtonEl.classList.remove('text-green-500');
                        copyFeedbackEl.textContent = '';
                        copyFeedbackEl.classList.remove('animate-pulse-once');
                    }, 2000);
                })
                .catch(err => {
                    console.error('Failed to copy:', err);
                    copyFeedbackEl.textContent = 'Failed to copy';
                });
        }

        async function handleRefinePrompt() {
            const userPrompt = userInputEl.value.trim();
            if (!userPrompt) {
                displayError("Please enter an initial prompt to refine.");
                return;
            }
            setLoading(true);
            clearError();
            outputContainerEl.classList.add('hidden-output');

            const requestBody = {
              contents: [ { role: "user", parts: [{ text: userPrompt }] } ],
              systemInstruction: { parts: [{ text: SYSTEM_INSTRUCTION_TEXT }] },
              generationConfig: { temperature: 0.3, topP: 0.95, topK: 64, maxOutputTokens: 1000 } // Increased for potentially longer HTML from Markdown
            };
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    let errMsg = `API Error: ${response.status} ${response.statusText}. ${errorData.error?.message || ''}`;
                    if (errorData.error?.message.includes("API key not valid")) errMsg += " Verify API key permissions.";
                    else if (errorData.error?.message.toLowerCase().includes("model not found")) errMsg += ` Model '${MODEL_NAME}' incorrect/inaccessible. Try 'gemini-1.5-flash-latest'.`;
                    else if (response.status === 400 && errorData.error?.message.includes("User location is not supported")) errMsg += " API not available in your region.";
                    throw new Error(errMsg);
                }
                const data = await response.json();
                if (data.candidates?.[0]?.content?.parts?.[0]?.text) {
                    const rawText = data.candidates[0].content.parts[0].text.trim();
                    // Parse the raw text as Markdown and set it as HTML
                    refinedPromptOutputEl.innerHTML = marked.parse(rawText);
                    outputContainerEl.classList.remove('hidden-output');
                } else if (data.promptFeedback?.blockReason) {
                    let reason = `Prompt blocked: ${data.promptFeedback.blockReason}.`;
                    data.promptFeedback.safetyRatings?.forEach(r => { if (r.blocked) reason += ` Cat: ${r.category}, Prob: ${r.probability}.`; });
                    displayError(reason);
                } else {
                    console.error('Unexpected API response structure:', data);
                    displayError("Unexpected API response. Check console.");
                }
            } catch (error) {
                console.error('Fetch error:', error);
                displayError(error.message || "Unknown error. Check console.");
            } finally {
                setLoading(false);
            }
        }

        function setLoading(isLoading) {
            refineButtonEl.disabled = isLoading;
            refineButtonEl.classList.toggle('opacity-75', isLoading);
            refineButtonEl.classList.toggle('cursor-not-allowed', isLoading);
            buttonTextEl.textContent = isLoading ? 'Refining...' : 'Refine Prompt';
            spinnerEl.classList.toggle('hidden', !isLoading);
        }

        function displayError(message) {
            if (errorMessageTextEl) errorMessageTextEl.textContent = message;
            errorDisplayEl.classList.remove('hidden');
            errorDisplayEl.classList.add('flex'); 
        }
        function clearError() {
            if (errorMessageTextEl) errorMessageTextEl.textContent = '';
            errorDisplayEl.classList.add('hidden');
            errorDisplayEl.classList.remove('flex');
        }

        async function handlePaste() {
            try {
                const text = await navigator.clipboard.readText();
                userInputEl.value = text;
            } catch (err) {
                console.error('Failed to paste:', err);
                displayError("Failed to paste from clipboard");
            }
        }
        
        function handleClear() {
            userInputEl.value = '';
            refinedPromptOutputEl.innerHTML = '';
            outputContainerEl.classList.add('hidden-output');
        }
        
        function copyToClipboard() {
            // For copying HTML content, it's better to get the raw text or specifically formatted text.
            // For now, let's copy the innerText of the rendered HTML, which should be reasonably close.
            // A more advanced approach might involve storing the raw API response separately for copying.
            const textToCopy = refinedPromptOutputEl.innerText || refinedPromptOutputEl.textContent; 
            if (!textToCopy || !copyButtonEl) return;

            navigator.clipboard.writeText(textToCopy)
                .then(() => {
                    copyFeedbackEl.textContent = 'Copied!';
                    copyButtonEl.innerHTML = checkmarkIconSVG;
                    copyButtonEl.classList.add('text-green-500', 'animate-pulse-once');
                    copyButtonEl.classList.remove('text-slate-600'); 

                    setTimeout(() => {
                        copyFeedbackEl.textContent = '';
                        copyButtonEl.innerHTML = copyIconSVG;
                        copyButtonEl.classList.remove('text-green-500', 'animate-pulse-once');
                        copyButtonEl.classList.add('text-slate-600'); 
                    }, 2500);
                })
                .catch(err => {
                    console.error('Failed to copy text: ', err);
                    copyFeedbackEl.textContent = 'Copy Failed!';
                });
        }
    </script>
</body>
</html>
